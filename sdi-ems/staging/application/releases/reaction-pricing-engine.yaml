apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: reaction-pricing-engine
  namespace: staging
spec:
  releaseName: reaction-pricing-engine
  chart:
    git: git@github.com:sportsdirect/sdi-releases.git
    path: charts/reaction-pricing-engine
    ref: develop
  values:
    image:
      repository: docker.io/sportsdirect/reaction-pricing-engine
      tag: 5467ad84a72ae6008e4bc85036e0249919a5a717
    imagePullSecrets:
      - name: reaction-docker-hub

    # Disabling temporarily.
    # See https://github.com/sportsdirect/reaction-devops/issues/95#issuecomment-513925115
    #command: ["tail", "-f", "/dev/null"]
    ingress:
      enabled: true
      hosts:
        - host: pe-staging.ems-test.io
          paths: ['/']
    jmx:
      image: reactioncommerce/jmx-prometheus-exporter
      imageTag: configurable-via-env
    config:
      jvmOpts: "-d64 -Xms2560m -Xmx2560m"
      bootstrapServers: "b-1.staging.zby85f.c5.kafka.us-east-1.amazonaws.com:9092,b-2.staging.zby85f.c5.kafka.us-east-1.amazonaws.com:9092,b-3.staging.zby85f.c5.kafka.us-east-1.amazonaws.com:9092"
      zookeeperConnect: "z-3.staging.zby85f.c5.kafka.us-east-1.amazonaws.com:2181,z-1.staging.zby85f.c5.kafka.us-east-1.amazonaws.com:2181,z-2.staging.zby85f.c5.kafka.us-east-1.amazonaws.com:2181"
      autoOffsetReset: "earliest"
      bufferedRecordsPerPartition: "0"
      cacheMaxBytesBuffering: "0"
      debugGraphqlErrors: "1"
    horizontalPodAutoscaler:
      enabled: false
    resources:
      requests:
        memory: 4Gi
        cpu: 1000m
      limits:
        memory: 4Gi
        cpu: 1000m
