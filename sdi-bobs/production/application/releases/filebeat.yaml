apiVersion: flux.weave.works/v1beta1
kind: HelmRelease
metadata:
  name: filebeat
  namespace: logging
spec:
  releaseName: filebeat
  chart:
    repository: https://kubernetes-charts.storage.googleapis.com
    name: filebeat
    version: 1.7.0
  values:
    extraVolumeMounts:
      - mountPath: /var/run/docker.sock
        name: var-run-docker-sock
    extraVolumes:
      - name: var-run-docker-sock
        hostPath:
          path: /var/run/docker.sock
          type: Socket
          readOnly: true
    indexTemplateLoad:
      - https://vpc-production-logs-h5thmymtp327yrdyej2mi2cm4a.us-east-1.es.amazonaws.com:443
    config:
      logging:
        level: warning
      processors:
        - add_cloud_metadata: {}
        - add_docker_metadata:
            labels.dedot: true
        - add_kubernetes_metadata:
            labels.dedot: true
            annotations.dedot: true
      output:
        elasticsearch:
          protocol: https
          hosts:
            - vpc-production-logs-h5thmymtp327yrdyej2mi2cm4a.us-east-1.es.amazonaws.com:443
        file:
          enabled: false
